create database refugio_animales;
use refugio_animales;
create table tabla_aux(
    ID_AUX INT PRIMARY KEY,
    ID_MASCOTA INT,
    NOMBRE_MASCOTA VARCHAR(250),
    EDAD_MASCOTA INT,
    RAZA_MASCOTA VARCHAR(250),
    FECHA_INGRESO date,
    ESTADO_MASCOTA VARCHAR(250),
    GENERO_MASCOTA VARCHAR(250),
    ESPECIE_MASCOTA VARCHAR(250),
    ID_REFUGIO INT,
    ID_SITIO INT,
    ID_PERSONA INT,
    NOMBRE_PERSONA VARCHAR(250),
    EDAD_PERSONA INT,
    EMPLEO_PERSONA VARCHAR(250),
    SALARIO_PERSONA NUMERIC(9),
    DIRECCION_PERSONA VARCHAR(250),
    CIUDAD_PERSONA VARCHAR(250),
    NOMBRE_REFUGIO VARCHAR(250),
    DIRECCION_REFUGIO VARCHAR(250),
    HORARIO_REFUGIO VARCHAR(250),
    MAIL_REFUGIO VARCHAR(250),
    TELEFONO_REFUGIO NUMERIC(9),
    ID_SEDE INT,
    ID_DONACION INT,
    TIPO_DONACION VARCHAR(250),
    DESCRIPCION_DONACION VARCHAR(250),
    ID_DONANTE VARCHAR(250),
    NOMBRE_DONANTE VARCHAR(250),
    EDAD_DONANTE INT,
    TELEFONO_DONANTE NUMERIC(9),
    MAIL_DONANTE VARCHAR(250),
    NOMBRE_SEDE VARCHAR(250),
    DIRECCION_SEDE VARCHAR(250),
    NOMBRE_RESCATE VARCHAR(250),
    DIRRECCION_RESCATE VARCHAR(250),
    ID_TRATAMIENTO VARCHAR(250),
    FECHA_TRATAMIENTO DATE,
    TIPO_TRATAMIENTO VARCHAR(250),
    DESCRIPCION_TRATAMIENTO VARCHAR(250)
);
select * from tabla_aux;
select * from persona;
select *from  donacion;
select * from donante;
select* from refugio;
select  * from mascota;
select  * from donacion;
select *from sede;
select  * from tratamiento;
select * from sitio_rescate;
select * from tratamiento_registro;




DROP TABLE tabla_aux;
DROP TABLE tratamiento_registro;
DROP TABLE persona;
DROP TABLE mascota;
DROP TABLE refugio;
drop table donacion;
DROP TABLE sitio_rescate;
DROP TABLE donante;
DROP TABLE tratamiento;
DROP TABLE sede;


USE refugio_animales;
create table donante(
    ID_DONANTE INT PRIMARY KEY,
    NOMBRE_DONANTE VARCHAR(250),
    EDAD_DONANTE VARCHAR(250),
    TELEFONO_DONANTE NUMERIC(9),
    MAIL_DONANTE VARCHAR(250)
);

create table sitio_rescate(
    ID_SITIO INT PRIMARY KEY,
    NOMBRE_RESCATE VARCHAR(250),
    DIRRECCION_RESCATE VARCHAR(250)
);

create table  tratamiento(
    ID_TRATAMIENTO INT PRIMARY KEY ,
    TIPO_TRATAMIENTO VARCHAR(250),
    DESCRIPCION_TRATAMIENTO VARCHAR(250)
);

create table donacion(
    ID_DONACION INT PRIMARY KEY ,
    TIPO_DONACION VARCHAR(250),
    DESCRIPCION_DONACION VARCHAR(250),
    ID_DONANTE INT,
    FOREIGN KEY (ID_DONANTE) REFERENCES donante(ID_DONANTE)
);

create table  sede(
    ID_SEDE INT PRIMARY KEY,
    NOMBRE_SEDE VARCHAR(250),
    DIRECCION_SEDE VARCHAR(250)
);

create table  refugio(
    ID_REFUGIO INT PRIMARY KEY ,
    NOMBRE_REFUGIO VARCHAR(250),
    DIRECCION_REFUGIO VARCHAR(250),
    HORARIO_REFUGIO VARCHAR(250),
    MAIL_REFUGIO VARCHAR(250),
    TELEFONO_REFUGIO NUMERIC(9),
    ID_SEDE INT,
    ID_DONACION INT,
    FOREIGN KEY (ID_SEDE) REFERENCES sede(ID_SEDE),
    FOREIGN KEY (ID_DONACION) REFERENCES donacion(ID_DONACION)

);

create table mascota(
    ID_MASCOTA INT PRIMARY KEY ,
    NOMBRE_MASCOTA VARCHAR(250),
    EDAD_MASCOTA INT,
    RAZA_MASCOTA VARCHAR(250),
    FECHA_INGRESO DATE,
    ESTADO_MASCOTA VARCHAR(250),
    GENERO_MASCOTA VARCHAR(250),
    ESPECIE_MASCOTA VARCHAR(250),
    ID_REFUGIO INT,
    ID_SITIO INT,
    FOREIGN KEY (ID_REFUGIO) REFERENCES refugio(ID_REFUGIO),
    FOREIGN KEY (ID_SITIO) REFERENCES sitio_rescate(ID_SITIO)
);

create table tratamiento_registro(
    ID_MASCOTA INT,
    ID_TRATAMIENTO INT,
    FECHA_TRATAMIENTO DATE,
    FOREIGN KEY (ID_MASCOTA) REFERENCES mascota(ID_MASCOTA),
    FOREIGN KEY (ID_TRATAMIENTO) REFERENCES tratamiento(ID_TRATAMIENTO)
);
create table persona(
    ID_PERSONA INT PRIMARY KEY,
    NOMBRE_PERSONA VARCHAR(250),
    EDAD_PERSONA INT,
    EMPLEO_PERSONA VARCHAR(250),
    SALARIO_PERSONA NUMERIC(9),
    DIRECCION_PERSONA VARCHAR(250),
    CIUDAD_PERSONA VARCHAR(250),
    ID_MASCOTA INT,
    FOREIGN KEY (ID_MASCOTA) REFERENCES mascota(ID_MASCOTA)
);


select * from persona;

drop procedure if exists InsertarDatos;
DELIMITER //
CREATE PROCEDURE InsertarDatos()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE ID_AUX_VAL INT;
    DECLARE ID_MASCOTA_VAL INT;
    DECLARE NOMBRE_MASCOTA_VAL VARCHAR(250);
    DECLARE EDAD_MASCOTA_VAL INT;
    DECLARE RAZA_MASCOTA_VAL VARCHAR(250);
    DECLARE FECHA_INGRESO_VAL DATE;
    DECLARE ESTADO_MASCOTA_VAL VARCHAR(250);
    DECLARE GENERO_MASCOTA_VAL VARCHAR(250);
    DECLARE ESPECIE_MASCOTA_VAL VARCHAR(250);
    DECLARE ID_REFUGIO_VAL INT;
    DECLARE ID_SITIO_VAL INT;
    DECLARE ID_PERSONA_VAL INT;
    DECLARE NOMBRE_PERSONA_VAL VARCHAR(250);
    DECLARE EDAD_PERSONA_VAL INT;
    DECLARE EMPLEO_PERSONA_VAL VARCHAR(250);
    DECLARE SALARIO_PERSONA_VAL NUMERIC(9);
    DECLARE DIRECCION_PERSONA_VAL VARCHAR(250);
    DECLARE CIUDAD_PERSONA_VAL VARCHAR(250);
    DECLARE NOMBRE_REFUGIO_VAL VARCHAR(250);
    DECLARE DIRECCION_REFUGIO_VAL VARCHAR(250);
    DECLARE HORARIO_REFUGIO_VAL VARCHAR(250);
    DECLARE MAIL_REFUGIO_VAL VARCHAR(250);
    DECLARE TELEFONO_REFUGIO_VAL NUMERIC(9);
    DECLARE ID_SEDE_VAL INT;
    DECLARE ID_DONACION_VAL INT;
    DECLARE TIPO_DONACION_VAL VARCHAR(250);
    DECLARE DESCRIPCION_DONACION_VAL VARCHAR(250);
    DECLARE ID_DONANTE_VAL VARCHAR(250);
    DECLARE NOMBRE_DONANTE_VAL VARCHAR(250);
    DECLARE EDAD_DONANTE_VAL INT;
    DECLARE TELEFONO_DONANTE_VAL NUMERIC(9);
    DECLARE MAIL_DONANTE_VAL VARCHAR(250);
    DECLARE NOMBRE_SEDE_VAL VARCHAR(250);
    DECLARE DIRECCION_SEDE_VAL VARCHAR(250);
    DECLARE NOMBRE_RESCATE_VAL VARCHAR(250);
    DECLARE DIRRECCION_RESCATE_VAL VARCHAR(250);
    DECLARE ID_TRATAMIENTO_VAL VARCHAR(250);
    DECLARE FECHA_TRATAMIENTO_VAL DATE;
    DECLARE TIPO_TRATAMIENTO_VAL VARCHAR(250);
    DECLARE DESCRIPCION_TRATAMIENTO_VAL VARCHAR(250);

    -- Cursor para recorrer los datos de la tabla auxiliar
    DECLARE cur CURSOR FOR SELECT * FROM tabla_aux;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    OPEN cur;

    read_loop: LOOP
        FETCH cur INTO ID_AUX_VAL,ID_MASCOTA_VAL , NOMBRE_MASCOTA_VAL ,EDAD_MASCOTA_VAL,RAZA_MASCOTA_VAL ,FECHA_INGRESO_VAL,ESTADO_MASCOTA_VAL,GENERO_MASCOTA_VAL,ESPECIE_MASCOTA_VAL,ID_REFUGIO_VAL,ID_SITIO_VAL,
            ID_PERSONA_VAL,NOMBRE_PERSONA_VAL ,EDAD_PERSONA_VAL ,EMPLEO_PERSONA_VAL ,SALARIO_PERSONA_VAL , DIRECCION_PERSONA_VAL,CIUDAD_PERSONA_VAL , NOMBRE_REFUGIO_VAL, DIRECCION_REFUGIO_VAL,HORARIO_REFUGIO_VAL,
            MAIL_REFUGIO_VAL ,TELEFONO_REFUGIO_VAL, ID_SEDE_VAL ,ID_DONACION_VAL,TIPO_DONACION_VAL,DESCRIPCION_DONACION_VAL ,ID_DONANTE_VAL,NOMBRE_DONANTE_VAL,EDAD_DONANTE_VAL ,TELEFONO_DONANTE_VAL,
            MAIL_DONANTE_VAL,NOMBRE_SEDE_VAL,DIRECCION_SEDE_VAL,NOMBRE_RESCATE_VAL,DIRRECCION_RESCATE_VAL,ID_TRATAMIENTO_VAL,FECHA_TRATAMIENTO_VAL,TIPO_TRATAMIENTO_VAL, DESCRIPCION_TRATAMIENTO_VAL ;
        IF done THEN
            LEAVE read_loop;
        END IF;

        IF NOT EXISTS (SELECT * FROM donante WHERE ID_DONANTE = ID_DONANTE_VAL) THEN
        INSERT INTO donante (ID_DONANTE, NOMBRE_DONANTE, EDAD_DONANTE, TELEFONO_DONANTE, MAIL_DONANTE)
        VALUES (ID_DONANTE_VAL, NOMBRE_DONANTE_VAL, EDAD_DONANTE_VAL, TELEFONO_DONANTE_VAL, MAIL_DONANTE_VAL);
        END IF;

        IF NOT EXISTS (SELECT * FROM sitio_rescate WHERE ID_SITIO = ID_SITIO_VAL) THEN
        INSERT INTO sitio_rescate(ID_SITIO ,NOMBRE_RESCATE ,DIRRECCION_RESCATE )
        VALUES (ID_SITIO_VAL,NOMBRE_RESCATE_VAL,DIRRECCION_RESCATE_VAL );
        END IF;

        IF NOT EXISTS (SELECT * FROM tratamiento WHERE ID_TRATAMIENTO = ID_TRATAMIENTO_VAL) THEN
        INSERT  INTO tratamiento(ID_TRATAMIENTO, TIPO_TRATAMIENTO ,DESCRIPCION_TRATAMIENTO )
        VALUES (ID_TRATAMIENTO_VAL, TIPO_TRATAMIENTO_VAL ,DESCRIPCION_TRATAMIENTO_VAL );
        END IF;

        IF NOT EXISTS (SELECT * FROM donacion WHERE ID_DONACION = ID_DONACION_VAL) THEN
        INSERT INTO  donacion(ID_DONACION,TIPO_DONACION,DESCRIPCION_DONACION ,ID_DONANTE )
        VALUES (ID_DONACION_VAL,TIPO_DONACION_VAL,DESCRIPCION_DONACION_VAL ,ID_DONANTE_VAL);
        END IF;

        IF NOT EXISTS (SELECT * FROM sede WHERE ID_SEDE = ID_SEDE_VAL) THEN
        INSERT INTO  sede(ID_SEDE,NOMBRE_SEDE,DIRECCION_SEDE )
        VALUES (ID_SEDE_VAL,NOMBRE_SEDE_VAL,DIRECCION_SEDE_VAL);
           END IF;

        IF NOT EXISTS (SELECT * FROM refugio WHERE ID_REFUGIO = ID_REFUGIO_VAL) THEN
        INSERT INTO refugio(ID_REFUGIO,NOMBRE_REFUGIO,DIRECCION_REFUGIO,HORARIO_REFUGIO,MAIL_REFUGIO,TELEFONO_REFUGIO,ID_SEDE,ID_DONACION)
        VALUES (ID_REFUGIO_VAL,NOMBRE_REFUGIO_VAL,DIRECCION_REFUGIO_VAL,HORARIO_REFUGIO_VAL,MAIL_REFUGIO_VAL,TELEFONO_REFUGIO_VAL,ID_SEDE_VAL,ID_DONACION_VAL);
        END IF;

        IF NOT EXISTS (SELECT * FROM mascota WHERE ID_MASCOTA = ID_MASCOTA_VAL) THEN
        INSERT INTO mascota(ID_MASCOTA,NOMBRE_MASCOTA,EDAD_MASCOTA,RAZA_MASCOTA, FECHA_INGRESO, ESTADO_MASCOTA,GENERO_MASCOTA,ESPECIE_MASCOTA, ID_REFUGIO, ID_SITIO)
        VALUES  (ID_MASCOTA_VAL,NOMBRE_MASCOTA_VAL,EDAD_MASCOTA_VAL,RAZA_MASCOTA_VAL, FECHA_INGRESO_VAL, ESTADO_MASCOTA_VAL,GENERO_MASCOTA_VAL,ESPECIE_MASCOTA_VAL, ID_REFUGIO_VAL, ID_SITIO_VAL);
        END IF;

        IF NOT EXISTS (SELECT * FROM tratamiento_registro WHERE ID_MASCOTA = ID_MASCOTA_VAL) THEN
        INSERT INTO tratamiento_registro(ID_MASCOTA ,ID_TRATAMIENTO,FECHA_TRATAMIENTO)
        VALUES (ID_MASCOTA_VAL ,ID_TRATAMIENTO_VAL,FECHA_TRATAMIENTO_VAL);
         END IF;

        IF NOT EXISTS (SELECT * FROM persona WHERE ID_PERSONA = ID_PERSONA_VAL) THEN
        INSERT INTO persona(ID_PERSONA,NOMBRE_PERSONA,EDAD_PERSONA,EMPLEO_PERSONA,SALARIO_PERSONA,DIRECCION_PERSONA,CIUDAD_PERSONA,ID_MASCOTA)
        VALUES (ID_PERSONA_VAL,NOMBRE_PERSONA_VAL,EDAD_PERSONA_VAL,EMPLEO_PERSONA_VAL,SALARIO_PERSONA_VAL,DIRECCION_PERSONA_VAL,CIUDAD_PERSONA_VAL,ID_MASCOTA_VAL);
        END IF;

    END LOOP;

    CLOSE cur;
END //
DELIMITER ;
SELECT *FROM tabla_aux;
CALL InsertarDatos();