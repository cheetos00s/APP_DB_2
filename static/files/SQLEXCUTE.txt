create database refugio_animales;
use refugio_animales;
create table tabla_aux(
    ID_AUX INT PRIMARY KEY,
    ID_MASCOTA INT,
    NOMBRE_MASCOTA VARCHAR(250),
    EDAD_MASCOTA INT,
    RAZA_MASCOTA VARCHAR(250),
    FECHA_INGRESO date,
    ESTADO_MASCOTA VARCHAR(250),
    GENERO_MASCOTA VARCHAR(250),
    ESPECIE_MASCOTA VARCHAR(250),
    ID_REFUGIO INT,
    ID_SITIO INT,
    ID_PERSONA INT,
    NOMBRE_PERSONA VARCHAR(250),
    EDAD_PERSONA INT,
    EMPLEO_PERSONA VARCHAR(250),
    SALARIO_PERSONA NUMERIC(9),
    DIRECCION_PERSONA VARCHAR(250),
    CIUDAD_PERSONA VARCHAR(250),
    NOMBRE_REFUGIO VARCHAR(250),
    DIRECCION_REFUGIO VARCHAR(250),
    HORARIO_REFUGIO VARCHAR(250),
    MAIL_REFUGIO VARCHAR(250),
    TELEFONO_REFUGIO NUMERIC(9),
    ID_SEDE INT,
    ID_DONACION INT,
    TIPO_DONACION VARCHAR(250),
    DESCRIPCION_DONACION VARCHAR(250),
    ID_DONANTE VARCHAR(250),
    NOMBRE_DONANTE VARCHAR(250),
    EDAD_DONANTE INT,
    TELEFONO_DONANTE NUMERIC(9),
    MAIL_DONANTE VARCHAR(250),
    NOMBRE_SEDE VARCHAR(250),
    DIRECCION_SEDE VARCHAR(250),
    NOMBRE_RESCATE VARCHAR(250),
    DIRRECCION_RESCATE VARCHAR(250),
    ID_TRATAMIENTO VARCHAR(250),
    FECHA_TRATAMIENTO DATE,
    TIPO_TRATAMIENTO VARCHAR(250),
    DESCRIPCION_TRATAMIENTO VARCHAR(250)
);
select * from tabla_aux;
select *from  donacion;
select * from donante;
select* from refugio;
select  * from mascota;
select  * from donacion;
select *from sede;
select  * from tratamiento;
select * from sitio_rescate;
DROP TABLE tabla_aux;
DROP TABLE tratamiento_registro;
DROP TABLE persona;
DROP TABLE mascota;
DROP TABLE refugio;
drop table donacion;
DROP TABLE sitio_rescate;
DROP TABLE donante;
DROP TABLE tratamiento;
DROP TABLE sede;


USE refugio_animales;
create table donante(
    ID_DONANTE INT PRIMARY KEY,
    NOMBRE_DONATE VARCHAR(250),
    EDAD_DONATE VARCHAR(250),
    TELEFONO_DONANTE NUMERIC(9),
    MAIL_DONANTE VARCHAR(250)
);

create table sitio_rescate(
    ID_SITIO INT PRIMARY KEY,
    NOMBRE_RESCATE VARCHAR(250),
    DIRRECCION_RESCATE VARCHAR(250)
);

create table  tratamiento(
    ID_TRATAMIENTO INT PRIMARY KEY ,
    TIPO_TRATAMIENTO VARCHAR(250),
    DESCRIPCION_TRATAMIENTO VARCHAR(250)
);

create table donacion(
    ID_DONACION INT PRIMARY KEY ,
    TIPO_DONACION VARCHAR(250),
    DESCRIPCION_DONACION VARCHAR(250),
    ID_DONANTE INT,
    FOREIGN KEY (ID_DONANTE) REFERENCES donante(ID_DONANTE)
);

create table  sede(
    ID_SEDE INT PRIMARY KEY,
    NOMBRE_SEDE VARCHAR(250),
    DIRECCION_SEDE VARCHAR(250)
);

create table  refugio(
    ID_REFUGIO INT PRIMARY KEY ,
    NOMBRE_REFUGIO VARCHAR(250),
    DIRRECCION_REFUGIO VARCHAR(250),
    HORARIO_REFUGIO VARCHAR(250),
    MAIL_REFUGIO VARCHAR(250),
    TELEFONO_REFUGIO NUMERIC(9),
    ID_SEDE INT,
    ID_DONACION INT,
    FOREIGN KEY (ID_SEDE) REFERENCES sede(ID_SEDE),
    FOREIGN KEY (ID_DONACION) REFERENCES donacion(ID_DONACION)

);

create table mascota(
    ID_MASCOTA INT PRIMARY KEY ,
    NOMBRE_MASCOTA VARCHAR(250),
    EDAD_MASCOTA INT,
    RAZA_MASCOTA VARCHAR(250),
    FECHA_INGRESO DATE,
    ESTADO_MASCOTA VARCHAR(250),
    GENERO_MASCOTA VARCHAR(250),
    ESPECIE_MASCOTA VARCHAR(250),
    ID_REFUGIO INT,
    ID_SITIO INT,
    FOREIGN KEY (ID_REFUGIO) REFERENCES refugio(ID_REFUGIO),
    FOREIGN KEY (ID_SITIO) REFERENCES sitio_rescate(ID_SITIO)
);

create table tratamiento_registro(
    ID_MASCOTA INT,
    ID_TRATAMIENTO INT,
    FECHA_TRATAMIENTO DATE,
    FOREIGN KEY (ID_MASCOTA) REFERENCES mascota(ID_MASCOTA),
    FOREIGN KEY (ID_TRATAMIENTO) REFERENCES tratamiento(ID_TRATAMIENTO)
);
create table persona(
    ID_PERSONA INT PRIMARY KEY,
    NOMBRE_PERSONA VARCHAR(250),
    EDAD_PERSONA INT,
    EMPLEO_PERSONA VARCHAR(250),
    SALARIO_PERSONA NUMERIC(9),
    DIRECCION_PERSONA VARCHAR(250),
    CIUDAD_PERSONA VARCHAR(250),
    ID_MASCOTA INT,
    FOREIGN KEY (ID_MASCOTA) REFERENCES mascota(ID_MASCOTA)
);


select * from persona;

drop procedure if exists InsertarDatos;
DELIMITER //
CREATE PROCEDURE InsertarDatos()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE ID_AUX INT;
    DECLARE ID_MASCOTA  INT;
    DECLARE NOMBRE_MASCOTA  VARCHAR(250);
    DECLARE EDAD_MASCOTA INT;
    DECLARE RAZA_MASCOTA VARCHAR(250);
    DECLARE FECHA_INGRESO DATE;
    DECLARE ESTADO_MASCOTA VARCHAR(250);
    DECLARE  GENERO_MASCOTA VARCHAR(250);
    DECLARE ESPECIE_MASCOTA VARCHAR(250);
    DECLARE ID_REFUGIO INT;
    DECLARE ID_SITIO INT;
    DECLARE ID_PERSONA INT;
    DECLARE NOMBRE_PERSONA VARCHAR(250);
    DECLARE EDAD_PERSONA INT;
    DECLARE EMPLEO_PERSONA VARCHAR(250);
    DECLARE SALARIO_PERSONA NUMERIC(9);
    DECLARE DIRECCION_PERSONA VARCHAR(250);
    DECLARE CIUDAD_PERSONA VARCHAR(250);
    DECLARE NOMBRE_REFUGIO VARCHAR(250);
    DECLARE DIRECCION_REFUGIO VARCHAR(250);
    DECLARE HORARIO_REFUGIO VARCHAR(250);
    DECLARE MAIL_REFUGIO VARCHAR(250);
    DECLARE TELEFONO_REFUGIO NUMERIC(9);
    DECLARE ID_SEDE INT;
    DECLARE ID_DONACION INT;
    DECLARE TIPO_DONACION VARCHAR(250);
    DECLARE DESCRIPCION_DONACION VARCHAR(250);
    DECLARE ID_DONANTE VARCHAR(250);
    DECLARE NOMBRE_DONANTE VARCHAR(250);
    DECLARE EDAD_DONANTE INT;
    DECLARE TELEFONO_DONANTE NUMERIC(9);
    DECLARE MAIL_DONANTE VARCHAR(250);
    DECLARE NOMBRE_SEDE VARCHAR(250);
    DECLARE DIRECCION_SEDE VARCHAR(250);
    DECLARE NOMBRE_RESCATE VARCHAR(250);
    DECLARE DIRRECCION_RESCATE VARCHAR(250);
    DECLARE ID_TRATAMIENTO VARCHAR(250);
    DECLARE FECHA_TRATAMIENTO DATE;
    DECLARE TIPO_TRATAMIENTO VARCHAR(250);
    DECLARE DESCRIPCION_TRATAMIENTO VARCHAR(250);

    -- Cursor para recorrer los datos de la tabla auxiliar
    DECLARE cur CURSOR FOR SELECT * FROM tabla_aux;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    OPEN cur;

    read_loop: LOOP
        FETCH cur INTO ID_AUX,ID_MASCOTA , NOMBRE_MASCOTA ,EDAD_MASCOTA,RAZA_MASCOTA ,FECHA_INGRESO,ESTADO_MASCOTA,GENERO_MASCOTA,ESPECIE_MASCOTA,ID_REFUGIO,ID_SITIO,
            ID_PERSONA,NOMBRE_PERSONA ,EDAD_PERSONA ,EMPLEO_PERSONA ,SALARIO_PERSONA , DIRECCION_PERSONA,CIUDAD_PERSONA , NOMBRE_REFUGIO, DIRECCION_REFUGIO,HORARIO_REFUGIO,
            MAIL_REFUGIO ,TELEFONO_REFUGIO, ID_SEDE ,ID_DONACION,TIPO_DONACION,DESCRIPCION_DONACION ,ID_DONANTE,NOMBRE_DONANTE,EDAD_DONANTE ,TELEFONO_DONANTE,
            MAIL_DONANTE,NOMBRE_SEDE,DIRECCION_SEDE,NOMBRE_RESCATE,DIRRECCION_RESCATE,ID_TRATAMIENTO,FECHA_TRATAMIENTO,TIPO_TRATAMIENTO, DESCRIPCION_TRATAMIENTO ;
        IF done THEN
            LEAVE read_loop;
        END IF;

        IF NOT EXISTS (SELECT 1 FROM donante WHERE ID_DONANTE = ID_DONANTE) THEN
        INSERT INTO donante (ID_DONANTE, NOMBRE_DONATE, EDAD_DONATE, TELEFONO_DONANTE, MAIL_DONANTE)
        VALUES (ID_DONANTE, NOMBRE_DONATE, EDAD_DONATE, TELEFONO_DONANTE, MAIL_DONANTE);
        END IF;

        IF NOT EXISTS (SELECT 1 FROM sitio_rescate WHERE ID_SITIO = ID_SITIO) THEN
        INSERT INTO sitio_rescate(ID_SITIO ,NOMBRE_RESCATE ,DIRRECCION_RESCATE )
        VALUES (ID_SITIO,NOMBRE_RESCATE,DIRRECCION_RESCATE );
        END IF;

        IF NOT EXISTS (SELECT 1 FROM tratamiento WHERE ID_TRATAMIENTO = ID_TRATAMIENTO) THEN
        INSERT  INTO tratamiento(ID_TRATAMIENTO, TIPO_TRATAMIENTO ,DESCRIPCION_TRATAMIENTO )
        VALUES (ID_TRATAMIENTO, TIPO_TRATAMIENTO ,DESCRIPCION_TRATAMIENTO );
        END IF;

        IF NOT EXISTS (SELECT 1 FROM donacion WHERE ID_DONACION = ID_DONACION) THEN
        INSERT INTO  donacion(ID_DONACION,TIPO_DONACION,DESCRIPCION_DONACION ,ID_DONANTE )
        VALUES (ID_DONACION,TIPO_DONACION,DESCRIPCION_DONACION ,ID_DONANTE);
        END IF;

        IF NOT EXISTS (SELECT 1 FROM sede WHERE ID_SEDE = ID_SEDE) THEN
        INSERT INTO  sede(ID_SEDE,NOMBRE_SEDE,DIRECCION_SEDE )
        VALUES (ID_SEDE,NOMBRE_SEDE,DIRECCION_SEDE);
           END IF;

        IF NOT EXISTS (SELECT 1 FROM refugio WHERE ID_REFUGIO = ID_REFUGIO) THEN
        INSERT INTO refugio(ID_REFUGIO,NOMBRE_REFUGIO,DIRRECCION_REFUGIO,HORARIO_REFUGIO,MAIL_REFUGIO,TELEFONO_REFUGIO,ID_SEDE,ID_DONACION)
        VALUES (ID_REFUGIO,NOMBRE_REFUGIO,DIRRECCION_REFUGIO,HORARIO_REFUGIO,MAIL_REFUGIO,TELEFONO_REFUGIO,ID_SEDE,ID_DONACION);
        END IF;

        IF NOT EXISTS (SELECT 1 FROM mascota WHERE ID_MASCOTA = ID_MASCOTA) THEN
        INSERT INTO mascota(ID_MASCOTA,NOMBRE_MASCOTA,EDAD_MASCOTA,RAZA_MASCOTA, FECHA_INGRESO, ESTADO_MASCOTA,GENERO_MASCOTA,ESPECIE_MASCOTA, ID_REFUGIO, ID_SITIO)
        VALUES  (ID_MASCOTA,NOMBRE_MASCOTA,EDAD_MASCOTA,RAZA_MASCOTA, FECHA_INGRESO, ESTADO_MASCOTA,GENERO_MASCOTA,ESPECIE_MASCOTA, ID_REFUGIO, ID_SITIO);
        END IF;

        IF NOT EXISTS (SELECT 1 FROM tratamiento_registro WHERE ID_MASCOTA = ID_MASCOTA) THEN
        INSERT INTO tratamiento_registro(ID_MASCOTA ,ID_TRATAMIENTO,FECHA_TRATAMIENTO)
        VALUES (ID_MASCOTA ,ID_TRATAMIENTO,FECHA_TRATAMIENTO);
         END IF;

        IF NOT EXISTS (SELECT 1 FROM persona WHERE ID_PERSONA = ID_PERSONA) THEN
        INSERT INTO persona(ID_PERSONA,NOMBRE_PERSONA,EDAD_PERSONA,EMPLEO_PERSONA,SALARIO_PERSONA,DIRECCION_PERSONA,CIUDAD_PERSONA,ID_MASCOTA)
        VALUES (ID_PERSONA,NOMBRE_PERSONA,EDAD_PERSONA,EMPLEO_PERSONA,SALARIO_PERSONA,DIRECCION_PERSONA,CIUDAD_PERSONA,ID_MASCOTA);
        END IF;

    END LOOP;

    CLOSE cur;
END //
DELIMITER ;
SELECT *FROM tabla_aux;
CALL InsertarDatos();